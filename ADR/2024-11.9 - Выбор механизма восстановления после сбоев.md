Вот обновленный документ с заменой Prometheus + Grafana и Sentry на Zabbix:

# Выбор механизма восстановления после сбоев

**Дата:** 12 декабря 2024 г.  
**Статус:** Принято

## Контекст

Система обрабатывает персональные данные пользователей и должна поддерживать высокую доступность (AVA01), а также быть надежной с возможностью восстановления после сбоев (DUR04). В соответствии с нефункциональными требованиями к надежности системы, необходимо реализовать эффективный механизм мониторинга и восстановления, который включает в себя как резервное копирование данных, так и отслеживание состояния системы в реальном времени.

## Решение

### Резервное копирование

- **Ежедневный бэкап данных:** Все данные (база данных, конфигурации, логи) будут ежедневно резервироваться в зашифрованном виде на удаленных серверах. Полные копии будут храниться в течение 365 дней, что обеспечивает защиту от потери данных. (DUR05)

### Восстановление данных

- **Автоматизированное восстановление:** В случае сбоя система будет автоматически восстанавливать данные из последней резервной копии. Процесс восстановления будет занимать не более 1 часа, что минимизирует время простоя системы. (DUR04)

### Мониторинг и оповещения

- **Zabbix:** Использование Zabbix для мониторинга состояния системы в реальном времени. Zabbix будет собирать и хранить метрики, а также отправлять оповещения о потенциальных проблемах, что позволит оперативно реагировать на инциденты и предотвращать сбои.

### Failover

- **Geo-репликация данных:** Реализация geo-репликации данных и автоматическое переключение на резервные ресурсы в случае отказа. Это значительно снижает риск потери данных и обеспечивает непрерывность работы системы.

## Обоснование

Выбранное решение соответствует требованиям к надежности системы и минимизирует время восстановления. Использование Zabbix для мониторинга состояния системы позволит оперативно реагировать на инциденты и поддерживать высокую доступность системы. Geo-репликация данных и резервные дата-центры обеспечивают дополнительный уровень защиты и восстановление системы в случае катастрофического сбоя.

## Последствия

### Положительные

- Минимизация потерь данных благодаря регулярному резервному копированию.
- Быстрое восстановление системы после сбоев, что улучшает пользовательский опыт.
- Соответствие требованиям к безопасности данных через своевременное реагирование на инциденты.

### Отрицательные

- Увеличенные затраты на инфраструктуру и резервные ресурсы (резервные сервера, дата-центры, средства мониторинга).
- Необходимость настройки сложных процессов автоматизации восстановления и резервного копирования, что требует дополнительных ресурсов и времени.